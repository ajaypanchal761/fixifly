<!DOCTYPE html>
<html>
<head>
    <title>OneSignal API Test</title>
    <script src="https://cdn.onesignal.com/sdks/web/v16/OneSignalSDK.page.js" defer></script>
</head>
<body>
    <h1>OneSignal API Test</h1>
    <div id="output"></div>

    <script>
        function log(message) {
            document.getElementById('output').innerHTML += '<p>' + message + '</p>';
            console.log(message);
        }

        async function testOneSignalAPIs() {
            log('üîç Testing OneSignal APIs...');
            
            // Wait for OneSignal to load
            if (typeof window.OneSignal === 'undefined') {
                log('‚è≥ Waiting for OneSignal SDK to load...');
                await new Promise((resolve) => {
                    const checkOneSignal = () => {
                        if (typeof window.OneSignal !== 'undefined') {
                            resolve();
                        } else {
                            setTimeout(checkOneSignal, 100);
                        }
                    };
                    checkOneSignal();
                });
            }

            log('‚úÖ OneSignal SDK loaded');
            log('üìã Main OneSignal methods: ' + Object.keys(window.OneSignal).join(', '));

            // Initialize OneSignal
            try {
                await window.OneSignal.init({
                    appId: '0e3861fd-d24e-4f93-a211-d64dfd966d17',
                    notifyButton: { enable: false },
                    allowLocalhostAsSecureOrigin: true,
                    autoRegister: false,
                    autoResubscribe: true,
                    notificationClickHandlerMatch: 'origin'
                });
                log('‚úÖ OneSignal initialized successfully');

                // Check User API
                if (window.OneSignal.User) {
                    log('üë§ User API methods: ' + Object.keys(window.OneSignal.User).join(', '));
                } else {
                    log('‚ùå User API not available');
                }

                // Check Notifications API
                if (window.OneSignal.Notifications) {
                    log('üîî Notifications API methods: ' + Object.keys(window.OneSignal.Notifications).join(', '));
                } else {
                    log('‚ùå Notifications API not available');
                }

                // Test specific methods
                const methods = [
                    'addExternalUserId',
                    'getPlayerId',
                    'addTags',
                    'sendTags',
                    'setExternalUserId',
                    'getPlayerId',
                    'isPushNotificationsEnabled',
                    'requestPermission',
                    'permission'
                ];

                log('üß™ Testing specific methods:');
                methods.forEach(method => {
                    let available = false;
                    let location = '';

                    if (window.OneSignal.User && window.OneSignal.User[method]) {
                        available = true;
                        location = 'User';
                    } else if (window.OneSignal.Notifications && window.OneSignal.Notifications[method]) {
                        available = true;
                        location = 'Notifications';
                    } else if (window.OneSignal[method]) {
                        available = true;
                        location = 'Main';
                    }

                    log(`   ${method}: ${available ? '‚úÖ (' + location + ')' : '‚ùå'}`);
                });

            } catch (error) {
                log('‚ùå OneSignal initialization failed: ' + error.message);
            }
        }

        // Run test when page loads
        window.addEventListener('load', testOneSignalAPIs);
    </script>
</body>
</html>
